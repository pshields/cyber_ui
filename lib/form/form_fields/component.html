<!-- Fields may either be passed in via the 'fields' input, or defined on the model instance, or defined statically on the model's constructor -->
<ng-container *ngFor="let field of getFields()">
  <mat-form-field *ngIf="field.config.useMatFormField">
    <!-- TextField template -->
    <textarea
      *ngIf="field.config.element === elements.TEXTAREA"
      matInput
      matTextareaAutosize
      [placeholder]="field.config.label"
      [required]="field.config.required"
      [cyberUiAutofocus]="field.config.autofocus"
      [ngModel]="field.getNgModelBoundValue(model)"
      (ngModelChange)="field.boundValueChangeHandler(model, $event)"
      (ngModelChange)="change.emit()"
      (keydown.enter)="field.config.saveOnEnter ? emitSaveAndReturnFalse() : null"></textarea>
    <!-- ChoiceField template -->
    <mat-select
        *ngIf="field.config.element === elements.SELECT"
        [placeholder]="field.config.label"
        [required]="field.config.required"
        [name]="field.config.propertyName"
        [(ngModel)]="model[field.config.propertyName]"
        (ngModelChange)="change.emit()"
        [cyberUiAutofocus]="field.autofocus"
        [multiple]="field.config.multiple">
      <mat-option *ngFor="let option of field.config.options" [value]="option.value">
       {{option.label}}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <!-- Help dialog placement when mat-form-field is used. Needs better styling / layout -->
  <button type="button" *ngIf="field.config.useMatFormField && field.config.helpDialog" mat-icon-button (click)="openHelpDialog(field.config.helpDialog)"><mat-icon>help</mat-icon></button>
  <!-- BooleanField template -->
  <div class="checkbox-container" *ngIf="field.config.element === elements.MAT_CHECKBOX">
    <mat-checkbox
        color="primary"
        [required]="field.config.required"
        [name]="field.config.propertyName"
        [(ngModel)]="model[field.config.propertyName]"
        (ngModelChange)="change.emit()"
        [cyberUiAutofocus]="field.config.autofocus">
    </mat-checkbox>
    <span>&nbsp;{{field.config.label}}</span>
    <button type="button" *ngIf="field.config.helpDialog" mat-icon-button (click)="openHelpDialog(field.config.helpDialog)"><mat-icon>help</mat-icon></button>
  </div>
  <div class="slide-toggle-container" *ngIf="field.config.element === elements.MAT_SLIDE_TOGGLE">
    <span>{{field.config.label}}&nbsp;</span>
    <mat-slide-toggle
        color="primary"
        [required]="field.config.required"
        [name]="field.config.propertyName"
        [(ngModel)]="model[field.config.propertyName]"
        (ngModelChange)="change.emit()"
        [cyberUiAutofocus]="field.config.autofocus">
    </mat-slide-toggle>
    <button type="button" *ngIf="field.config.helpDialog" mat-icon-button (click)="openHelpDialog(field.config.helpDialog)"><mat-icon>help</mat-icon></button>
  </div>
  <!-- ValueInNumericRangeField template -->
  <div class="slider-container" *ngIf="field.config.element === elements.MAT_SLIDER">
    <span>{{field.config.label}}&nbsp;</span>
    <mat-slider
        color="primary"
        [required]="field.config.required"
        [name]="field.config.propertyName"
        [(ngModel)]="model[field.config.propertyName]"
        (ngModelChange)="change.emit()"
        [max]="field.config.maxValue"
        [min]="field.config.minValue"
        [step]="field.config.step"
        [cyberUiAutofocus]="field.autofocus">
    </mat-slider>
    <span>{{model[field.config.propertyName]|number:field.config.digitinfo}}</span>
    <!-- button needs type="button" to avoid being interpreted as a submit button: https://stackoverflow.com/a/47186021/860525 -->
    <button type="button" *ngIf="field.config.helpDialog" mat-icon-button (click)="openHelpDialog(field.config.helpDialog)"><mat-icon>help</mat-icon></button>
  </div>
  <!-- DiscreteProbabilityDistributionField template -->
  <!-- TODO Move this to a cyber-ui-discrete-probability-distribution-field component -->
  <div
      *ngIf="field.config.element === elements.DISCRETE_PROBABILITY_DISTRIBUTION"
      class="discrete-probability-distribution-field">
    <p>{{field.config.label}}</p>
    <div class="outcome-probability-assignment"
         *ngFor="let assignment of model[field.config.propertyName]">
      <mat-form-field [class.outcome]="true">
        <textarea
            matInput
            matTextareaAutosize
            placeholder="Outcome"
            [(ngModel)]="assignment.outcome.label"></textarea>
      </mat-form-field>
      <mat-form-field [class.probability]="true">
        <textarea
            matInput
            matTextareaAutosize
            placeholder="Probability"
            [(ngModel)]="assignment.probability.value"></textarea>
      </mat-form-field>
    </div>
    <button
        type="button"
        color="primary"
        mat-stroked-button
        (click)="(model[field.config.propertyName] === undefined && (model[field.config.propertyName] = []) && false) || model[field.config.propertyName].push({outcome: {label: ''}, probability: {value: ''}})">ADD ANOTHER OUTCOME</button>
  </div>
  <!-- FieldListListField template -->
  <!-- TODO Consider moving this to its own component at some point -->
  <div
      *ngIf="field.config.element === elements.CYBER_UI_FORM_FIELDS_LIST"
      class="field-list-list-field">
    <p>{{field.config.label}}</p>
    <div *ngIf="model[field.config.propertyName] !== undefined">
      <div
          *ngFor="let item of model[field.config.propertyName]; let i = index"
          class="field-list-list-field-item">
        <!-- button needs type="button" to avoid being interpreted as a submit button: https://stackoverflow.com/a/47186021/860525 -->
        <button
            type="button"
            mat-icon-button
            color="primary"
            (click)="model[field.config.propertyName].splice(i, 1)">
          <mat-icon aria-label="Remove item">close</mat-icon>
        </button>
        <cyber-ui-form-fields
            [fields]="field.config.fields"
            [model]="item"
            (change)="change.emit()"
            (save)="save.emit()">
        </cyber-ui-form-fields>
      </div>
    </div>
    <button
        type="button"
        color="primary"
        mat-stroked-button
        (click)="(model[field.config.propertyName] === undefined && (model[field.config.propertyName] = []) && false) || model[field.config.propertyName].push({}) && changeDetectorRef.detectChanges()">ADD {{field.config.contentTypeLabel}}</button>
  </div>
</ng-container>
